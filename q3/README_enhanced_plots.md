# Q3 增强绘图功能说明

## 概述

本模块为第三题的多基站网络切片资源分配问题提供了全面的可视化分析功能，包括超时惩罚、时延变化、马尔可夫决策过程等关键指标的图形化展示。

## 新增功能

### 1. 超时惩罚分析 (`timeout_penalties.png`)
- **超时惩罚变化趋势**: 展示各切片在不同决策时刻的超时惩罚次数变化
- **超时惩罚分布**: 通过直方图显示超时惩罚的分布情况
- **累积超时惩罚**: 显示累积的超时惩罚趋势
- **超时惩罚热力图**: 以热力图形式展示超时惩罚的时空分布

### 2. 时延变化分析 (`delay_analysis.png`)
- **平均时延变化趋势**: 监控各切片的平均时延变化
- **最大时延变化趋势**: 跟踪最大时延的变化情况
- **时延方差变化趋势**: 分析时延的稳定性
- **时延分布箱线图**: 展示时延的统计分布特征
- **时延与SLA对比**: 将实际时延与服务等级协议(SLA)要求进行对比
- **时延热力图**: 以热力图形式展示时延的时空分布

### 3. 马尔可夫决策分析 (`markov_decision_analysis.png`)
- **资源分配变化率**: 分析各切片资源分配的动态变化
- **决策稳定性分析**: 评估决策策略的稳定性
- **状态空间探索**: 可视化智能体在状态空间中的探索轨迹
- **决策序列热力图**: 展示决策序列的时空模式

### 4. 队列分析 (`queue_analysis.png`)
- **队列长度变化趋势**: 监控各基站各切片队列长度的变化
- **平均排队时延变化**: 跟踪排队时延的变化情况
- **队列长度分布**: 通过箱线图展示队列长度的统计特征
- **队列长度热力图**: 以热力图形式展示队列状态的时空分布

### 5. 增强的基础图表
- **奖励分析**: 包含即时奖励、累积奖励和奖励分布
- **资源分配**: 包含RB分配策略和资源利用率
- **功率控制**: 包含功率控制策略和总功率消耗

## 数据记录

评估过程现在记录以下详细信息：

### 基础信息
- `decision_idx`: 决策索引
- `reward`: 即时奖励
- `total_reward`: 累积奖励
- `time_ms`: 时间戳(毫秒)

### 资源分配信息
- `{BS}_{slice}_RB`: 各基站各切片的RB分配
- `{BS}_{slice}_P`: 各基站各切片的功率设置

### 队列状态信息
- `{BS}_{slice}_queue_len`: 队列长度
- `{BS}_{slice}_avg_queue_delay`: 平均排队时延

### 性能指标
- `{slice}_timeout_penalty`: 超时惩罚次数
- `{slice}_avg_delay`: 平均时延
- `{slice}_max_delay`: 最大时延
- `{slice}_delay_variance`: 时延方差

## 使用方法

### 1. 运行评估
```bash
python q3/q3_eval.py
```

### 2. 生成图表
```bash
python q3/q3_plot.py
```

### 3. 自定义参数
```bash
python q3/q3_plot.py --csv your_data.csv --outdir your_output_dir
```

## 中文字体支持

代码自动检测系统中文字体的可用性：
- 如果中文字体可用，使用中文标签
- 如果中文字体不可用，自动切换到英文标签
- 支持多种中文字体：SimHei、Arial Unicode MS等

## 技术特点

1. **自适应字体**: 根据系统环境自动选择中文或英文标签
2. **多维度分析**: 从时间、空间、统计等多个维度分析系统性能
3. **可视化丰富**: 包含折线图、直方图、箱线图、热力图等多种图表类型
4. **数据完整性**: 记录详细的决策过程和性能指标
5. **模块化设计**: 各分析功能独立，便于维护和扩展

## 输出文件

所有图表保存在 `q3_plots/` 目录下：
- `reward_over_time.png`: 奖励分析
- `{BS}_rb_allocation.png`: 各基站资源分配
- `{BS}_power_levels.png`: 各基站功率控制
- `timeout_penalties.png`: 超时惩罚分析
- `delay_analysis.png`: 时延变化分析
- `markov_decision_analysis.png`: 马尔可夫决策分析
- `queue_analysis.png`: 队列分析

## 注意事项

1. 确保数据文件 `q3_eval_decisions.csv` 存在且格式正确
2. 图表生成需要足够的磁盘空间
3. 中文字体支持依赖于系统环境
4. 建议在分析大量数据时使用更高分辨率的图表设置 